<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="generator" content="Asciidoctor 2.0.18">
<meta name="author" content="Andrew Oberstar">
<title>Locations in AsciiDoc ASG</title>
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700">
<style>
/*! Asciidoctor default stylesheet | MIT License | https://asciidoctor.org */
/* Uncomment the following line when using as a custom stylesheet */
/* @import "https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700"; */
html{font-family:sans-serif;-webkit-text-size-adjust:100%}
a{background:none}
a:focus{outline:thin dotted}
a:active,a:hover{outline:0}
h1{font-size:2em;margin:.67em 0}
b,strong{font-weight:bold}
abbr{font-size:.9em}
abbr[title]{cursor:help;border-bottom:1px dotted #dddddf;text-decoration:none}
dfn{font-style:italic}
hr{height:0}
mark{background:#ff0;color:#000}
code,kbd,pre,samp{font-family:monospace;font-size:1em}
pre{white-space:pre-wrap}
q{quotes:"\201C" "\201D" "\2018" "\2019"}
small{font-size:80%}
sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}
sup{top:-.5em}
sub{bottom:-.25em}
img{border:0}
svg:not(:root){overflow:hidden}
figure{margin:0}
audio,video{display:inline-block}
audio:not([controls]){display:none;height:0}
fieldset{border:1px solid silver;margin:0 2px;padding:.35em .625em .75em}
legend{border:0;padding:0}
button,input,select,textarea{font-family:inherit;font-size:100%;margin:0}
button,input{line-height:normal}
button,select{text-transform:none}
button,html input[type=button],input[type=reset],input[type=submit]{-webkit-appearance:button;cursor:pointer}
button[disabled],html input[disabled]{cursor:default}
input[type=checkbox],input[type=radio]{padding:0}
button::-moz-focus-inner,input::-moz-focus-inner{border:0;padding:0}
textarea{overflow:auto;vertical-align:top}
table{border-collapse:collapse;border-spacing:0}
*,::before,::after{box-sizing:border-box}
html,body{font-size:100%}
body{background:#fff;color:rgba(0,0,0,.8);padding:0;margin:0;font-family:"Noto Serif","DejaVu Serif",serif;line-height:1;position:relative;cursor:auto;-moz-tab-size:4;-o-tab-size:4;tab-size:4;word-wrap:anywhere;-moz-osx-font-smoothing:grayscale;-webkit-font-smoothing:antialiased}
a:hover{cursor:pointer}
img,object,embed{max-width:100%;height:auto}
object,embed{height:100%}
img{-ms-interpolation-mode:bicubic}
.left{float:left!important}
.right{float:right!important}
.text-left{text-align:left!important}
.text-right{text-align:right!important}
.text-center{text-align:center!important}
.text-justify{text-align:justify!important}
.hide{display:none}
img,object,svg{display:inline-block;vertical-align:middle}
textarea{height:auto;min-height:50px}
select{width:100%}
.subheader,.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{line-height:1.45;color:#7a2518;font-weight:400;margin-top:0;margin-bottom:.25em}
div,dl,dt,dd,ul,ol,li,h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6,pre,form,p,blockquote,th,td{margin:0;padding:0}
a{color:#2156a5;text-decoration:underline;line-height:inherit}
a:hover,a:focus{color:#1d4b8f}
a img{border:0}
p{line-height:1.6;margin-bottom:1.25em;text-rendering:optimizeLegibility}
p aside{font-size:.875em;line-height:1.35;font-style:italic}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{font-family:"Open Sans","DejaVu Sans",sans-serif;font-weight:300;font-style:normal;color:#ba3925;text-rendering:optimizeLegibility;margin-top:1em;margin-bottom:.5em;line-height:1.0125em}
h1 small,h2 small,h3 small,#toctitle small,.sidebarblock>.content>.title small,h4 small,h5 small,h6 small{font-size:60%;color:#e99b8f;line-height:0}
h1{font-size:2.125em}
h2{font-size:1.6875em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.375em}
h4,h5{font-size:1.125em}
h6{font-size:1em}
hr{border:solid #dddddf;border-width:1px 0 0;clear:both;margin:1.25em 0 1.1875em}
em,i{font-style:italic;line-height:inherit}
strong,b{font-weight:bold;line-height:inherit}
small{font-size:60%;line-height:inherit}
code{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;font-weight:400;color:rgba(0,0,0,.9)}
ul,ol,dl{line-height:1.6;margin-bottom:1.25em;list-style-position:outside;font-family:inherit}
ul,ol{margin-left:1.5em}
ul li ul,ul li ol{margin-left:1.25em;margin-bottom:0}
ul.circle{list-style-type:circle}
ul.disc{list-style-type:disc}
ul.square{list-style-type:square}
ul.circle ul:not([class]),ul.disc ul:not([class]),ul.square ul:not([class]){list-style:inherit}
ol li ul,ol li ol{margin-left:1.25em;margin-bottom:0}
dl dt{margin-bottom:.3125em;font-weight:bold}
dl dd{margin-bottom:1.25em}
blockquote{margin:0 0 1.25em;padding:.5625em 1.25em 0 1.1875em;border-left:1px solid #ddd}
blockquote,blockquote p{line-height:1.6;color:rgba(0,0,0,.85)}
@media screen and (min-width:768px){h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2}
h1{font-size:2.75em}
h2{font-size:2.3125em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.6875em}
h4{font-size:1.4375em}}
table{background:#fff;margin-bottom:1.25em;border:1px solid #dedede;word-wrap:normal}
table thead,table tfoot{background:#f7f8f7}
table thead tr th,table thead tr td,table tfoot tr th,table tfoot tr td{padding:.5em .625em .625em;font-size:inherit;color:rgba(0,0,0,.8);text-align:left}
table tr th,table tr td{padding:.5625em .625em;font-size:inherit;color:rgba(0,0,0,.8)}
table tr.even,table tr.alt{background:#f8f8f7}
table thead tr th,table tfoot tr th,table tbody tr td,table tr td,table tfoot tr td{line-height:1.6}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2;word-spacing:-.05em}
h1 strong,h2 strong,h3 strong,#toctitle strong,.sidebarblock>.content>.title strong,h4 strong,h5 strong,h6 strong{font-weight:400}
.center{margin-left:auto;margin-right:auto}
.stretch{width:100%}
.clearfix::before,.clearfix::after,.float-group::before,.float-group::after{content:" ";display:table}
.clearfix::after,.float-group::after{clear:both}
:not(pre).nobreak{word-wrap:normal}
:not(pre).nowrap{white-space:nowrap}
:not(pre).pre-wrap{white-space:pre-wrap}
:not(pre):not([class^=L])>code{font-size:.9375em;font-style:normal!important;letter-spacing:0;padding:.1em .5ex;word-spacing:-.15em;background:#f7f7f8;border-radius:4px;line-height:1.45;text-rendering:optimizeSpeed}
pre{color:rgba(0,0,0,.9);font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;line-height:1.45;text-rendering:optimizeSpeed}
pre code,pre pre{color:inherit;font-size:inherit;line-height:inherit}
pre>code{display:block}
pre.nowrap,pre.nowrap pre{white-space:pre;word-wrap:normal}
em em{font-style:normal}
strong strong{font-weight:400}
.keyseq{color:rgba(51,51,51,.8)}
kbd{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;display:inline-block;color:rgba(0,0,0,.8);font-size:.65em;line-height:1.45;background:#f7f7f7;border:1px solid #ccc;border-radius:3px;box-shadow:0 1px 0 rgba(0,0,0,.2),inset 0 0 0 .1em #fff;margin:0 .15em;padding:.2em .5em;vertical-align:middle;position:relative;top:-.1em;white-space:nowrap}
.keyseq kbd:first-child{margin-left:0}
.keyseq kbd:last-child{margin-right:0}
.menuseq,.menuref{color:#000}
.menuseq b:not(.caret),.menuref{font-weight:inherit}
.menuseq{word-spacing:-.02em}
.menuseq b.caret{font-size:1.25em;line-height:.8}
.menuseq i.caret{font-weight:bold;text-align:center;width:.45em}
b.button::before,b.button::after{position:relative;top:-1px;font-weight:400}
b.button::before{content:"[";padding:0 3px 0 2px}
b.button::after{content:"]";padding:0 2px 0 3px}
p a>code:hover{color:rgba(0,0,0,.9)}
#header,#content,#footnotes,#footer{width:100%;margin:0 auto;max-width:62.5em;*zoom:1;position:relative;padding-left:.9375em;padding-right:.9375em}
#header::before,#header::after,#content::before,#content::after,#footnotes::before,#footnotes::after,#footer::before,#footer::after{content:" ";display:table}
#header::after,#content::after,#footnotes::after,#footer::after{clear:both}
#content{margin-top:1.25em}
#content::before{content:none}
#header>h1:first-child{color:rgba(0,0,0,.85);margin-top:2.25rem;margin-bottom:0}
#header>h1:first-child+#toc{margin-top:8px;border-top:1px solid #dddddf}
#header>h1:only-child,body.toc2 #header>h1:nth-last-child(2){border-bottom:1px solid #dddddf;padding-bottom:8px}
#header .details{border-bottom:1px solid #dddddf;line-height:1.45;padding-top:.25em;padding-bottom:.25em;padding-left:.25em;color:rgba(0,0,0,.6);display:flex;flex-flow:row wrap}
#header .details span:first-child{margin-left:-.125em}
#header .details span.email a{color:rgba(0,0,0,.85)}
#header .details br{display:none}
#header .details br+span::before{content:"\00a0\2013\00a0"}
#header .details br+span.author::before{content:"\00a0\22c5\00a0";color:rgba(0,0,0,.85)}
#header .details br+span#revremark::before{content:"\00a0|\00a0"}
#header #revnumber{text-transform:capitalize}
#header #revnumber::after{content:"\00a0"}
#content>h1:first-child:not([class]){color:rgba(0,0,0,.85);border-bottom:1px solid #dddddf;padding-bottom:8px;margin-top:0;padding-top:1rem;margin-bottom:1.25rem}
#toc{border-bottom:1px solid #e7e7e9;padding-bottom:.5em}
#toc>ul{margin-left:.125em}
#toc ul.sectlevel0>li>a{font-style:italic}
#toc ul.sectlevel0 ul.sectlevel1{margin:.5em 0}
#toc ul{font-family:"Open Sans","DejaVu Sans",sans-serif;list-style-type:none}
#toc li{line-height:1.3334;margin-top:.3334em}
#toc a{text-decoration:none}
#toc a:active{text-decoration:underline}
#toctitle{color:#7a2518;font-size:1.2em}
@media screen and (min-width:768px){#toctitle{font-size:1.375em}
body.toc2{padding-left:15em;padding-right:0}
#toc.toc2{margin-top:0!important;background:#f8f8f7;position:fixed;width:15em;left:0;top:0;border-right:1px solid #e7e7e9;border-top-width:0!important;border-bottom-width:0!important;z-index:1000;padding:1.25em 1em;height:100%;overflow:auto}
#toc.toc2 #toctitle{margin-top:0;margin-bottom:.8rem;font-size:1.2em}
#toc.toc2>ul{font-size:.9em;margin-bottom:0}
#toc.toc2 ul ul{margin-left:0;padding-left:1em}
#toc.toc2 ul.sectlevel0 ul.sectlevel1{padding-left:0;margin-top:.5em;margin-bottom:.5em}
body.toc2.toc-right{padding-left:0;padding-right:15em}
body.toc2.toc-right #toc.toc2{border-right-width:0;border-left:1px solid #e7e7e9;left:auto;right:0}}
@media screen and (min-width:1280px){body.toc2{padding-left:20em;padding-right:0}
#toc.toc2{width:20em}
#toc.toc2 #toctitle{font-size:1.375em}
#toc.toc2>ul{font-size:.95em}
#toc.toc2 ul ul{padding-left:1.25em}
body.toc2.toc-right{padding-left:0;padding-right:20em}}
#content #toc{border:1px solid #e0e0dc;margin-bottom:1.25em;padding:1.25em;background:#f8f8f7;border-radius:4px}
#content #toc>:first-child{margin-top:0}
#content #toc>:last-child{margin-bottom:0}
#footer{max-width:none;background:rgba(0,0,0,.8);padding:1.25em}
#footer-text{color:hsla(0,0%,100%,.8);line-height:1.44}
#content{margin-bottom:.625em}
.sect1{padding-bottom:.625em}
@media screen and (min-width:768px){#content{margin-bottom:1.25em}
.sect1{padding-bottom:1.25em}}
.sect1:last-child{padding-bottom:0}
.sect1+.sect1{border-top:1px solid #e7e7e9}
#content h1>a.anchor,h2>a.anchor,h3>a.anchor,#toctitle>a.anchor,.sidebarblock>.content>.title>a.anchor,h4>a.anchor,h5>a.anchor,h6>a.anchor{position:absolute;z-index:1001;width:1.5ex;margin-left:-1.5ex;display:block;text-decoration:none!important;visibility:hidden;text-align:center;font-weight:400}
#content h1>a.anchor::before,h2>a.anchor::before,h3>a.anchor::before,#toctitle>a.anchor::before,.sidebarblock>.content>.title>a.anchor::before,h4>a.anchor::before,h5>a.anchor::before,h6>a.anchor::before{content:"\00A7";font-size:.85em;display:block;padding-top:.1em}
#content h1:hover>a.anchor,#content h1>a.anchor:hover,h2:hover>a.anchor,h2>a.anchor:hover,h3:hover>a.anchor,#toctitle:hover>a.anchor,.sidebarblock>.content>.title:hover>a.anchor,h3>a.anchor:hover,#toctitle>a.anchor:hover,.sidebarblock>.content>.title>a.anchor:hover,h4:hover>a.anchor,h4>a.anchor:hover,h5:hover>a.anchor,h5>a.anchor:hover,h6:hover>a.anchor,h6>a.anchor:hover{visibility:visible}
#content h1>a.link,h2>a.link,h3>a.link,#toctitle>a.link,.sidebarblock>.content>.title>a.link,h4>a.link,h5>a.link,h6>a.link{color:#ba3925;text-decoration:none}
#content h1>a.link:hover,h2>a.link:hover,h3>a.link:hover,#toctitle>a.link:hover,.sidebarblock>.content>.title>a.link:hover,h4>a.link:hover,h5>a.link:hover,h6>a.link:hover{color:#a53221}
details,.audioblock,.imageblock,.literalblock,.listingblock,.stemblock,.videoblock{margin-bottom:1.25em}
details{margin-left:1.25rem}
details>summary{cursor:pointer;display:block;position:relative;line-height:1.6;margin-bottom:.625rem;outline:none;-webkit-tap-highlight-color:transparent}
details>summary::-webkit-details-marker{display:none}
details>summary::before{content:"";border:solid transparent;border-left:solid;border-width:.3em 0 .3em .5em;position:absolute;top:.5em;left:-1.25rem;transform:translateX(15%)}
details[open]>summary::before{border:solid transparent;border-top:solid;border-width:.5em .3em 0;transform:translateY(15%)}
details>summary::after{content:"";width:1.25rem;height:1em;position:absolute;top:.3em;left:-1.25rem}
.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{text-rendering:optimizeLegibility;text-align:left;font-family:"Noto Serif","DejaVu Serif",serif;font-size:1rem;font-style:italic}
table.tableblock.fit-content>caption.title{white-space:nowrap;width:0}
.paragraph.lead>p,#preamble>.sectionbody>[class=paragraph]:first-of-type p{font-size:1.21875em;line-height:1.6;color:rgba(0,0,0,.85)}
.admonitionblock>table{border-collapse:separate;border:0;background:none;width:100%}
.admonitionblock>table td.icon{text-align:center;width:80px}
.admonitionblock>table td.icon img{max-width:none}
.admonitionblock>table td.icon .title{font-weight:bold;font-family:"Open Sans","DejaVu Sans",sans-serif;text-transform:uppercase}
.admonitionblock>table td.content{padding-left:1.125em;padding-right:1.25em;border-left:1px solid #dddddf;color:rgba(0,0,0,.6);word-wrap:anywhere}
.admonitionblock>table td.content>:last-child>:last-child{margin-bottom:0}
.exampleblock>.content{border:1px solid #e6e6e6;margin-bottom:1.25em;padding:1.25em;background:#fff;border-radius:4px}
.exampleblock>.content>:first-child{margin-top:0}
.exampleblock>.content>:last-child{margin-bottom:0}
.sidebarblock{border:1px solid #dbdbd6;margin-bottom:1.25em;padding:1.25em;background:#f3f3f2;border-radius:4px}
.sidebarblock>:first-child{margin-top:0}
.sidebarblock>:last-child{margin-bottom:0}
.sidebarblock>.content>.title{color:#7a2518;margin-top:0;text-align:center}
.exampleblock>.content>:last-child>:last-child,.exampleblock>.content .olist>ol>li:last-child>:last-child,.exampleblock>.content .ulist>ul>li:last-child>:last-child,.exampleblock>.content .qlist>ol>li:last-child>:last-child,.sidebarblock>.content>:last-child>:last-child,.sidebarblock>.content .olist>ol>li:last-child>:last-child,.sidebarblock>.content .ulist>ul>li:last-child>:last-child,.sidebarblock>.content .qlist>ol>li:last-child>:last-child{margin-bottom:0}
.literalblock pre,.listingblock>.content>pre{border-radius:4px;overflow-x:auto;padding:1em;font-size:.8125em}
@media screen and (min-width:768px){.literalblock pre,.listingblock>.content>pre{font-size:.90625em}}
@media screen and (min-width:1280px){.literalblock pre,.listingblock>.content>pre{font-size:1em}}
.literalblock pre,.listingblock>.content>pre:not(.highlight),.listingblock>.content>pre[class=highlight],.listingblock>.content>pre[class^="highlight "]{background:#f7f7f8}
.literalblock.output pre{color:#f7f7f8;background:rgba(0,0,0,.9)}
.listingblock>.content{position:relative}
.listingblock code[data-lang]::before{display:none;content:attr(data-lang);position:absolute;font-size:.75em;top:.425rem;right:.5rem;line-height:1;text-transform:uppercase;color:inherit;opacity:.5}
.listingblock:hover code[data-lang]::before{display:block}
.listingblock.terminal pre .command::before{content:attr(data-prompt);padding-right:.5em;color:inherit;opacity:.5}
.listingblock.terminal pre .command:not([data-prompt])::before{content:"$"}
.listingblock pre.highlightjs{padding:0}
.listingblock pre.highlightjs>code{padding:1em;border-radius:4px}
.listingblock pre.prettyprint{border-width:0}
.prettyprint{background:#f7f7f8}
pre.prettyprint .linenums{line-height:1.45;margin-left:2em}
pre.prettyprint li{background:none;list-style-type:inherit;padding-left:0}
pre.prettyprint li code[data-lang]::before{opacity:1}
pre.prettyprint li:not(:first-child) code[data-lang]::before{display:none}
table.linenotable{border-collapse:separate;border:0;margin-bottom:0;background:none}
table.linenotable td[class]{color:inherit;vertical-align:top;padding:0;line-height:inherit;white-space:normal}
table.linenotable td.code{padding-left:.75em}
table.linenotable td.linenos,pre.pygments .linenos{border-right:1px solid;opacity:.35;padding-right:.5em;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}
pre.pygments span.linenos{display:inline-block;margin-right:.75em}
.quoteblock{margin:0 1em 1.25em 1.5em;display:table}
.quoteblock:not(.excerpt)>.title{margin-left:-1.5em;margin-bottom:.75em}
.quoteblock blockquote,.quoteblock p{color:rgba(0,0,0,.85);font-size:1.15rem;line-height:1.75;word-spacing:.1em;letter-spacing:0;font-style:italic;text-align:justify}
.quoteblock blockquote{margin:0;padding:0;border:0}
.quoteblock blockquote::before{content:"\201c";float:left;font-size:2.75em;font-weight:bold;line-height:.6em;margin-left:-.6em;color:#7a2518;text-shadow:0 1px 2px rgba(0,0,0,.1)}
.quoteblock blockquote>.paragraph:last-child p{margin-bottom:0}
.quoteblock .attribution{margin-top:.75em;margin-right:.5ex;text-align:right}
.verseblock{margin:0 1em 1.25em}
.verseblock pre{font-family:"Open Sans","DejaVu Sans",sans-serif;font-size:1.15rem;color:rgba(0,0,0,.85);font-weight:300;text-rendering:optimizeLegibility}
.verseblock pre strong{font-weight:400}
.verseblock .attribution{margin-top:1.25rem;margin-left:.5ex}
.quoteblock .attribution,.verseblock .attribution{font-size:.9375em;line-height:1.45;font-style:italic}
.quoteblock .attribution br,.verseblock .attribution br{display:none}
.quoteblock .attribution cite,.verseblock .attribution cite{display:block;letter-spacing:-.025em;color:rgba(0,0,0,.6)}
.quoteblock.abstract blockquote::before,.quoteblock.excerpt blockquote::before,.quoteblock .quoteblock blockquote::before{display:none}
.quoteblock.abstract blockquote,.quoteblock.abstract p,.quoteblock.excerpt blockquote,.quoteblock.excerpt p,.quoteblock .quoteblock blockquote,.quoteblock .quoteblock p{line-height:1.6;word-spacing:0}
.quoteblock.abstract{margin:0 1em 1.25em;display:block}
.quoteblock.abstract>.title{margin:0 0 .375em;font-size:1.15em;text-align:center}
.quoteblock.excerpt>blockquote,.quoteblock .quoteblock{padding:0 0 .25em 1em;border-left:.25em solid #dddddf}
.quoteblock.excerpt,.quoteblock .quoteblock{margin-left:0}
.quoteblock.excerpt blockquote,.quoteblock.excerpt p,.quoteblock .quoteblock blockquote,.quoteblock .quoteblock p{color:inherit;font-size:1.0625rem}
.quoteblock.excerpt .attribution,.quoteblock .quoteblock .attribution{color:inherit;font-size:.85rem;text-align:left;margin-right:0}
p.tableblock:last-child{margin-bottom:0}
td.tableblock>.content{margin-bottom:1.25em;word-wrap:anywhere}
td.tableblock>.content>:last-child{margin-bottom:-1.25em}
table.tableblock,th.tableblock,td.tableblock{border:0 solid #dedede}
table.grid-all>*>tr>*{border-width:1px}
table.grid-cols>*>tr>*{border-width:0 1px}
table.grid-rows>*>tr>*{border-width:1px 0}
table.frame-all{border-width:1px}
table.frame-ends{border-width:1px 0}
table.frame-sides{border-width:0 1px}
table.frame-none>colgroup+*>:first-child>*,table.frame-sides>colgroup+*>:first-child>*{border-top-width:0}
table.frame-none>:last-child>:last-child>*,table.frame-sides>:last-child>:last-child>*{border-bottom-width:0}
table.frame-none>*>tr>:first-child,table.frame-ends>*>tr>:first-child{border-left-width:0}
table.frame-none>*>tr>:last-child,table.frame-ends>*>tr>:last-child{border-right-width:0}
table.stripes-all>*>tr,table.stripes-odd>*>tr:nth-of-type(odd),table.stripes-even>*>tr:nth-of-type(even),table.stripes-hover>*>tr:hover{background:#f8f8f7}
th.halign-left,td.halign-left{text-align:left}
th.halign-right,td.halign-right{text-align:right}
th.halign-center,td.halign-center{text-align:center}
th.valign-top,td.valign-top{vertical-align:top}
th.valign-bottom,td.valign-bottom{vertical-align:bottom}
th.valign-middle,td.valign-middle{vertical-align:middle}
table thead th,table tfoot th{font-weight:bold}
tbody tr th{background:#f7f8f7}
tbody tr th,tbody tr th p,tfoot tr th,tfoot tr th p{color:rgba(0,0,0,.8);font-weight:bold}
p.tableblock>code:only-child{background:none;padding:0}
p.tableblock{font-size:1em}
ol{margin-left:1.75em}
ul li ol{margin-left:1.5em}
dl dd{margin-left:1.125em}
dl dd:last-child,dl dd:last-child>:last-child{margin-bottom:0}
li p,ul dd,ol dd,.olist .olist,.ulist .ulist,.ulist .olist,.olist .ulist{margin-bottom:.625em}
ul.checklist,ul.none,ol.none,ul.no-bullet,ol.no-bullet,ol.unnumbered,ul.unstyled,ol.unstyled{list-style-type:none}
ul.no-bullet,ol.no-bullet,ol.unnumbered{margin-left:.625em}
ul.unstyled,ol.unstyled{margin-left:0}
li>p:empty:only-child::before{content:"";display:inline-block}
ul.checklist>li>p:first-child{margin-left:-1em}
ul.checklist>li>p:first-child>.fa-square-o:first-child,ul.checklist>li>p:first-child>.fa-check-square-o:first-child{width:1.25em;font-size:.8em;position:relative;bottom:.125em}
ul.checklist>li>p:first-child>input[type=checkbox]:first-child{margin-right:.25em}
ul.inline{display:flex;flex-flow:row wrap;list-style:none;margin:0 0 .625em -1.25em}
ul.inline>li{margin-left:1.25em}
.unstyled dl dt{font-weight:400;font-style:normal}
ol.arabic{list-style-type:decimal}
ol.decimal{list-style-type:decimal-leading-zero}
ol.loweralpha{list-style-type:lower-alpha}
ol.upperalpha{list-style-type:upper-alpha}
ol.lowerroman{list-style-type:lower-roman}
ol.upperroman{list-style-type:upper-roman}
ol.lowergreek{list-style-type:lower-greek}
.hdlist>table,.colist>table{border:0;background:none}
.hdlist>table>tbody>tr,.colist>table>tbody>tr{background:none}
td.hdlist1,td.hdlist2{vertical-align:top;padding:0 .625em}
td.hdlist1{font-weight:bold;padding-bottom:1.25em}
td.hdlist2{word-wrap:anywhere}
.literalblock+.colist,.listingblock+.colist{margin-top:-.5em}
.colist td:not([class]):first-child{padding:.4em .75em 0;line-height:1;vertical-align:top}
.colist td:not([class]):first-child img{max-width:none}
.colist td:not([class]):last-child{padding:.25em 0}
.thumb,.th{line-height:0;display:inline-block;border:4px solid #fff;box-shadow:0 0 0 1px #ddd}
.imageblock.left{margin:.25em .625em 1.25em 0}
.imageblock.right{margin:.25em 0 1.25em .625em}
.imageblock>.title{margin-bottom:0}
.imageblock.thumb,.imageblock.th{border-width:6px}
.imageblock.thumb>.title,.imageblock.th>.title{padding:0 .125em}
.image.left,.image.right{margin-top:.25em;margin-bottom:.25em;display:inline-block;line-height:0}
.image.left{margin-right:.625em}
.image.right{margin-left:.625em}
a.image{text-decoration:none;display:inline-block}
a.image object{pointer-events:none}
sup.footnote,sup.footnoteref{font-size:.875em;position:static;vertical-align:super}
sup.footnote a,sup.footnoteref a{text-decoration:none}
sup.footnote a:active,sup.footnoteref a:active{text-decoration:underline}
#footnotes{padding-top:.75em;padding-bottom:.75em;margin-bottom:.625em}
#footnotes hr{width:20%;min-width:6.25em;margin:-.25em 0 .75em;border-width:1px 0 0}
#footnotes .footnote{padding:0 .375em 0 .225em;line-height:1.3334;font-size:.875em;margin-left:1.2em;margin-bottom:.2em}
#footnotes .footnote a:first-of-type{font-weight:bold;text-decoration:none;margin-left:-1.05em}
#footnotes .footnote:last-of-type{margin-bottom:0}
#content #footnotes{margin-top:-.625em;margin-bottom:0;padding:.75em 0}
div.unbreakable{page-break-inside:avoid}
.big{font-size:larger}
.small{font-size:smaller}
.underline{text-decoration:underline}
.overline{text-decoration:overline}
.line-through{text-decoration:line-through}
.aqua{color:#00bfbf}
.aqua-background{background:#00fafa}
.black{color:#000}
.black-background{background:#000}
.blue{color:#0000bf}
.blue-background{background:#0000fa}
.fuchsia{color:#bf00bf}
.fuchsia-background{background:#fa00fa}
.gray{color:#606060}
.gray-background{background:#7d7d7d}
.green{color:#006000}
.green-background{background:#007d00}
.lime{color:#00bf00}
.lime-background{background:#00fa00}
.maroon{color:#600000}
.maroon-background{background:#7d0000}
.navy{color:#000060}
.navy-background{background:#00007d}
.olive{color:#606000}
.olive-background{background:#7d7d00}
.purple{color:#600060}
.purple-background{background:#7d007d}
.red{color:#bf0000}
.red-background{background:#fa0000}
.silver{color:#909090}
.silver-background{background:#bcbcbc}
.teal{color:#006060}
.teal-background{background:#007d7d}
.white{color:#bfbfbf}
.white-background{background:#fafafa}
.yellow{color:#bfbf00}
.yellow-background{background:#fafa00}
span.icon>.fa{cursor:default}
a span.icon>.fa{cursor:inherit}
.admonitionblock td.icon [class^="fa icon-"]{font-size:2.5em;text-shadow:1px 1px 2px rgba(0,0,0,.5);cursor:default}
.admonitionblock td.icon .icon-note::before{content:"\f05a";color:#19407c}
.admonitionblock td.icon .icon-tip::before{content:"\f0eb";text-shadow:1px 1px 2px rgba(155,155,0,.8);color:#111}
.admonitionblock td.icon .icon-warning::before{content:"\f071";color:#bf6900}
.admonitionblock td.icon .icon-caution::before{content:"\f06d";color:#bf3400}
.admonitionblock td.icon .icon-important::before{content:"\f06a";color:#bf0000}
.conum[data-value]{display:inline-block;color:#fff!important;background:rgba(0,0,0,.8);border-radius:50%;text-align:center;font-size:.75em;width:1.67em;height:1.67em;line-height:1.67em;font-family:"Open Sans","DejaVu Sans",sans-serif;font-style:normal;font-weight:bold}
.conum[data-value] *{color:#fff!important}
.conum[data-value]+b{display:none}
.conum[data-value]::after{content:attr(data-value)}
pre .conum[data-value]{position:relative;top:-.125em}
b.conum *{color:inherit!important}
.conum:not([data-value]):empty{display:none}
dt,th.tableblock,td.content,div.footnote{text-rendering:optimizeLegibility}
h1,h2,p,td.content,span.alt,summary{letter-spacing:-.01em}
p strong,td.content strong,div.footnote strong{letter-spacing:-.005em}
p,blockquote,dt,td.content,span.alt,summary{font-size:1.0625rem}
p{margin-bottom:1.25rem}
.sidebarblock p,.sidebarblock dt,.sidebarblock td.content,p.tableblock{font-size:1em}
.exampleblock>.content{background:#fffef7;border-color:#e0e0dc;box-shadow:0 1px 4px #e0e0dc}
.print-only{display:none!important}
@page{margin:1.25cm .75cm}
@media print{*{box-shadow:none!important;text-shadow:none!important}
html{font-size:80%}
a{color:inherit!important;text-decoration:underline!important}
a.bare,a[href^="#"],a[href^="mailto:"]{text-decoration:none!important}
a[href^="http:"]:not(.bare)::after,a[href^="https:"]:not(.bare)::after{content:"(" attr(href) ")";display:inline-block;font-size:.875em;padding-left:.25em}
abbr[title]{border-bottom:1px dotted}
abbr[title]::after{content:" (" attr(title) ")"}
pre,blockquote,tr,img,object,svg{page-break-inside:avoid}
thead{display:table-header-group}
svg{max-width:100%}
p,blockquote,dt,td.content{font-size:1em;orphans:3;widows:3}
h2,h3,#toctitle,.sidebarblock>.content>.title{page-break-after:avoid}
#header,#content,#footnotes,#footer{max-width:none}
#toc,.sidebarblock,.exampleblock>.content{background:none!important}
#toc{border-bottom:1px solid #dddddf!important;padding-bottom:0!important}
body.book #header{text-align:center}
body.book #header>h1:first-child{border:0!important;margin:2.5em 0 1em}
body.book #header .details{border:0!important;display:block;padding:0!important}
body.book #header .details span:first-child{margin-left:0!important}
body.book #header .details br{display:block}
body.book #header .details br+span::before{content:none!important}
body.book #toc{border:0!important;text-align:left!important;padding:0!important;margin:0!important}
body.book #toc,body.book #preamble,body.book h1.sect0,body.book .sect1>h2{page-break-before:always}
.listingblock code[data-lang]::before{display:block}
#footer{padding:0 .9375em}
.hide-on-print{display:none!important}
.print-only{display:block!important}
.hide-for-print{display:none!important}
.show-for-print{display:inherit!important}}
@media amzn-kf8,print{#header>h1:first-child{margin-top:1.25rem}
.sect1{padding:0!important}
.sect1+.sect1{border:0}
#footer{background:none}
#footer-text{color:rgba(0,0,0,.6);font-size:.9em}}
@media amzn-kf8{#header,#content,#footnotes,#footer{padding:0}}
</style>
</head>
<body class="article">
<div id="header">
<h1>Locations in AsciiDoc ASG</h1>
<div class="details">
<span id="author" class="author">Andrew Oberstar</span><br>
<span id="email" class="email"><a href="mailto:andrew@ajoberstar.org">andrew@ajoberstar.org</a></span><br>
</div>
<div id="toc" class="toc">
<div id="toctitle">Table of Contents</div>
<ul class="sectlevel1">
<li><a href="#_background">Background</a></li>
<li><a href="#_questions">Questions</a></li>
<li><a href="#_non_goals">Non-Goals</a></li>
<li><a href="#_terminology">Terminology</a></li>
<li><a href="#_pre_spec_approach">Pre-Spec Approach</a></li>
<li><a href="#_in_the_wild">In the Wild</a>
<ul class="sectlevel2">
<li><a href="#_parsers">Parsers</a></li>
<li><a href="#_languages">Languages</a></li>
<li><a href="#_editors">Editors</a></li>
<li><a href="#_summary">Summary</a></li>
</ul>
</li>
<li><a href="#_my_proposal">My Proposal</a></li>
</ul>
</div>
</div>
<div id="content">
<div id="preamble">
<div class="sectionbody">
<div class="paragraph">
<p>I (Andrew Oberstar) am not affiliated with the AsciiDoc working group or any of its projects. However, I am trying to participate as a community member by producing my own implementation of the specification alongside its development in order to support the goal of a final v1 specification.</p>
</div>
<div class="paragraph">
<p>Where this document refers to the specification&#8217;s content/goals/intentions, this is purely my interpretation of documents, discussions, and code I have seen and is intended to be representative of the AsciiDoc language project state as of specification milestone v0.3.0, TCK milestone v0.1.0, and the parsing lab as of its commit on 2023-08-07.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph">
<p>If I misinterpreted the current position of the AsciiDoc language project anywhere in this document, please let me know of inaccuracies, so I can correct them.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_background">Background</h2>
<div class="sectionbody">
<div class="paragraph">
<p>As part of AsciiDoc&#8217;s specification, an Abstract Semantic Graph (ASG) is being defined to unambiguously represent the parsed structure of an AsciiDoc document. Implementations can optionally include <code>location</code> properties on ASG elements to denote the range where the element can be found in the source document.</p>
</div>
<div class="paragraph">
<p>When an implementation chooses to emit <code>location</code> properties in its ASG output, the specification will mandate that they conform to defined location tracking rules so that there is consistency between implementations.</p>
</div>
<div class="paragraph">
<p>The pre-spec <a href="https://gitlab.eclipse.org/eclipse/asciidoc-lang/asciidoc-tck">asciidoc-tck</a> and  <a href="https://github.com/opendevise/asciidoc-parsing-lab/">asciidoc-parsing-lab</a> have an existing approach that has yet to be formalized in the spec but is being tracked in <a href="https://gitlab.eclipse.org/eclipse/asciidoc-lang/asciidoc-lang/-/issues/48">issue 48</a>.</p>
</div>
<div class="paragraph">
<p>This document raises questions that the spec&#8217;s location tracking section should answer to better clarify its goals and behavior, surveys some prior art on location tracking, and ends with my proposal for how locations should be calculated.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_questions">Questions</h2>
<div class="sectionbody">
<div class="paragraph">
<p>As part of defining the ASG&#8217;s location tracking the following questions are important to clearly answer:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p><strong>Purpose/Goals:</strong> What are locations in the ASG in service of? What are the expected use cases and how does the chosen scheme tailor to them?</p>
</li>
<li>
<p><strong>File offsets or not:</strong> Is the included data only line offset and column offset? Or should the file offset  be included as well?</p>
</li>
<li>
<p><strong>Zero-based or one-based:</strong> Should the file/line/column offsets be zero-based or one-based? The answer isn&#8217;t inherently the same for all 3 elements.</p>
</li>
<li>
<p><strong>Inclusive or exclusive:</strong> Are the start and end positions inclusive or exclusive of the matched characters? Again this may differ between start and end.</p>
</li>
<li>
<p><strong>Special representation:</strong> Does a newline character (or any other character)  have special representation in the format? If so what is the rationale for this, as it implies an exception that must be accounted for by the parser?</p>
</li>
</ol>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_non_goals">Non-Goals</h2>
<div class="sectionbody">
<div class="paragraph">
<p>When I originally raised this topic in <a href="https://asciidoc.zulipchat.com/#narrow/stream/335219-asciidoc-lang/topic/Locations.20and.20the.20spec">Zulip</a> I interleaved what are ultimately multiple different issues, so I want to be clear what this document <em>isn&#8217;t</em> about:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>What characters are considered part of any given element. This is not about whether trailing newlines are part of blocks or inlines.</p>
<div class="paragraph">
<p>For the purpose of this document, presume that an element&#8217;s bounds are defined elsewhere.</p>
</div>
</li>
<li>
<p>Which ASG objects should have locations on them. Again, for the purpose of this document, this can be presumed to be defined elsewhere in the spec.</p>
</li>
<li>
<p>How locations should be tracked for attribute references or included files. While this would likely be part of a decision record on location tracking, it&#8217;s not something I&#8217;m trying to cover in any way here.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>This is purely about calculation of the values in the <code>location</code> property presuming those points are decided.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_terminology">Terminology</h2>
<div class="sectionbody">
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
This is only meant for clarity of this document and not a presumption of the AsciiDoc project&#8217;s terminology.
</td>
</tr>
</table>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">element</dt>
<dd>
<p>A given syntax component in the language (e.g. paragraph, open block, constrained strong span, etc.)</p>
</dd>
<dt class="hdlist1">character</dt>
<dd>
<p>Any valid Unicode code point</p>
</dd>
<dt class="hdlist1">visible character</dt>
<dd>
<p>Any <strong>character</strong> that is typically displayed in a human-oriented editor (with settings like "visible whitespace" turned off)</p>
</dd>
<dt class="hdlist1">newline</dt>
<dd>
<p>A <code>\n</code> <strong>character</strong>, <code>0A</code> in Unicode (hexadecimal)</p>
</dd>
<dt class="hdlist1">line</dt>
<dd>
<p>As defined by <a href="https://pubs.opengroup.org/onlinepubs/9699919799/basedefs/V1_chap03.html#tag_03_206">POSIX</a></p>
<div class="quoteblock">
<blockquote>
<div class="paragraph">
<p>3.206 Line</p>
</div>
<div class="paragraph">
<p>A sequence of zero or more non- &lt;newline&gt; characters plus a terminating &lt;newline&gt; character.</p>
</div>
</blockquote>
</div>
</dd>
<dt class="hdlist1">empty line</dt>
<dd>
<p>As defined by <a href="">POSIX</a></p>
<div class="quoteblock">
<blockquote>
<div class="paragraph">
<p>3.145 Empty Line</p>
</div>
<div class="paragraph">
<p>A line consisting of only a &lt;newline&gt;; see also Blank Line.</p>
</div>
</blockquote>
</div>
</dd>
<dt class="hdlist1">position</dt>
<dd>
<p>A representation of a place within in a file, often used to describe where a <strong>character</strong> or sequence of characters can be found. See <strong>file offset</strong>, <strong>line offset</strong>, <strong>column offset</strong> for concrete ways to talk about a position.</p>
</dd>
<dt class="hdlist1">range</dt>
<dd>
<p>A bounded representation of a sequence of <strong>characters</strong> within a file. Defined by start and end <strong>positions</strong> (both of which must be clarified as inclusive or exclusive). See <strong>location</strong> for a concrete way to talk about a range.</p>
</dd>
<dt class="hdlist1">file offset</dt>
<dd>
<p>A single-integer representation of a <strong>position</strong> within a file. This is independent of <strong>line offset</strong> and <strong>column offset</strong> and identifies a byte or <strong>character</strong> index within the file contents (when thought of as an array or string). File offsets may be 0-based or 1-based. A file offset can independently describe a position.</p>
</dd>
<dt class="hdlist1">line offset</dt>
<dd>
<p>A single-integer representation of the <strong>line</strong> where a <strong>position</strong> can be found. In a zero-based representation, this is the count of <strong>newline</strong> characters preceding the position being described. In one-based, just add 1 to that count. Special character representations may have rules requiring other values for certain characters or positions. A line offset can only fully describe a position with a corresponding <strong>column offset</strong>.</p>
</dd>
<dt class="hdlist1">column offset</dt>
<dd>
<p>A single-integer representation of the column within a <strong>line</strong> where a <strong>position</strong> can be found. In a zero-based representation, this is the count of <strong>characters</strong> that precede the character being described. In one-based, just add 1 to that count. Special character representations may have rules requiring other values for certain characters or positions. A column offset can only fully describe a character&#8217;s position with a corresponding <strong>line offset</strong>.</p>
</dd>
<dt class="hdlist1">location</dt>
<dd>
<p>The <code>location</code> property within the ASG representing a <strong>range</strong> that indicates the bounds of an <strong>element</strong>.</p>
</dd>
<dt class="hdlist1">cursor</dt>
<dd>
<p>An editor&#8217;s (often visual) current <strong>position</strong> within a file, typically indicating the position where text will be inserted or of the <strong>character</strong> that would be overwritten by the user&#8217;s next command.</p>
</dd>
<dt class="hdlist1">selection</dt>
<dd>
<p>An editor&#8217;s (often visual) representation of a <strong>range</strong> that will be acted on by the user&#8217;s next command.</p>
</dd>
</dl>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_pre_spec_approach">Pre-Spec Approach</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Pre-spec location tracking is defined in the implementation of the asciidoc-tck and asciidoc-parsing-lab and discussed in the following to issue threads:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="https://gitlab.eclipse.org/eclipse/asciidoc-lang/asciidoc-lang/-/issues/28#note_1107831">issue 28</a></p>
</li>
<li>
<p><a href="https://gitlab.eclipse.org/eclipse/asciidoc-lang/asciidoc-lang/-/issues/48">issue 48</a></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>In terms of answers to the questions listed above:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p><strong>Purpose/Goals:</strong> So far I haven&#8217;t found a direct articulation of this, but the following are quotes that seemed most informative to me:</p>
<div class="quoteblock">
<blockquote>
<div class="paragraph">
<p>When computing the end location of a block, the column of the trailing newline is not included. The block ends at the visible location in the source document, not at the newline that follows it. For a delimited block with a delimiter length of 4, the end column is 4, not 5. There are two reasons for this. First, it points to a column in the source that the cursor can go. Second, it ensures that the end column for a block is consistent regardless of whether it&#8217;s at the end of the document or somewhere in the middle of it.</p>
</div>
</blockquote>
</div>
<div class="quoteblock">
<blockquote>
<div class="paragraph">
<p>Normally, the lowest column value is 1. However, there are two cases when the column must be 0. First, if a document has no blocks, then the start and end column is 0. The 0 column indicates that the source does not occupy any space. If the first line of the document is empty, then the start column is 0. The 0 column indicates that there is no content on the first line, only a newline that follows it. Similarly, if the contents of a verbatim block starts with an empty line, then the start column of the content is 0, again indicating that there is no content on the first line, only the newline that follows it. If the content has a trailing empty line, then the end column is 0 for the same reason.</p>
</div>
</blockquote>
</div>
<div class="paragraph">
<p>This suggests to me that the optimization is towards an end user, who may be trying to visually locate the element identified by the ASG location, but I may be misinterpreting.</p>
</div>
</li>
<li>
<p><strong>File offsets or not:</strong> Currently, I&#8217;ve seen no proposal that includes a file offset within the <code>location</code> property.</p>
</li>
<li>
<p><strong>Zero-based or one-based:</strong> Lines and columns are one-based, with the exception of newlines (see below).</p>
</li>
<li>
<p><strong>Inclusive or exclusive:</strong> Start and end locations are both inclusive.</p>
</li>
<li>
<p><strong>Special handling:</strong> Locations that represent the newline character of an empty line have a column of 0, while in all other cases the first character of a line is considered to have column 1. The stated intent is to communicate that the line contains no visible characters (content).</p>
</li>
</ol>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">Commentary</div>
<div class="paragraph">
<p>In my attempt at an implementation, special handling of newlines requires an exception in the code to calculate locations. Presuming I&#8217;m not mistaken that this is considered "exceptional" or "special" representation, I believe it needs a stronger justification in the specification of the value it provides (and to whom) when weighed against a simpler approach that treats a newline as any other character, just one that is considered the final column in a line.</p>
</div>
<div class="paragraph">
<p>Again this is purely for calculation of a newlines position, not about whether it is or is not included in the location of any given element.</p>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_in_the_wild">In the Wild</h2>
<div class="sectionbody">
<div class="paragraph">
<p>This section covers how other software calculates and uses positions and ranges.</p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">Commentary</div>
<div class="paragraph">
<p>A clear intention in defining a specification is to encourage new and compliant implementations using a variety of technologies to both:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Further the "reach" of AsciiDoc, making it available in more software than it currently is.</p>
</li>
<li>
<p>Ensure that AsciiDoc means AsciiDoc&#8482; and not a superficial equivalence like many Markdown flavors have.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>This suggests that success of the specification will be a balance between:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>How easy is it for an implementor to interpret and comply with the details of the specification?</p>
</li>
<li>
<p>How compatible is the specification with the behavior of the existing Asciidoctor and AsciiDoc.py implementations that have defined the language to date? (i.e. how many documents will "break" when using a spec-compliant implementation)</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>To further the criteria of "easy to implement", there is clear value in conforming to approaches commonly used in related software in the industry as it will reduce the effort needed to both produce and make use of compliant implementations of AsciiDoc.</p>
</div>
<div class="paragraph">
<p>An implementor may choose an existing parser library for their implementation or want to hook their implementation up to an editor for navigation, highlighting, or problem reporting and do so with a minimum of effort. This is something I, personally, think is a highly valuable outcome of the specification and should be considered highly in the goals and purpose of location tracking.</p>
</div>
<div class="paragraph">
<p>While this could lead to an implementation not as obviously clear to a human document author, it is more likely that a document author is a consumer of the implementation&#8217;s integration with other software than the direct output of the ASG. As such it <em>is</em> human-friendly to be machine-friendly.</p>
</div>
<div class="paragraph">
<p>On the compatibility criteria, I haven&#8217;t seen any indication that there is anything within Asciidoctor that tracks full locations for each element. I do see some code for <code>:source_location</code>, but it appears to only track line positions. This implies to me that this is a point the spec is much freer to make any decision on than most of the parsing behavior ones.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_parsers">Parsers</h3>
<div class="sect3">
<h4 id="_peggy_js">Peggy.js</h4>
<div class="paragraph">
<p><a href="https://peggyjs.org/">Peggy</a> is the chosen parser for the reference grammar of AsciiDoc. It includes location tracking as one of its features.</p>
</div>
<div class="paragraph">
<p>You can see the <code>peg-test/</code> folder for a sample of its behavior.</p>
</div>
<div class="paragraph">
<p>With the grammar:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>document = blank_line* heading? blank_line* text*
eol = "\n"
title = [a-zA-Z]+
heading = "#"+ " " title eol
text = [a-zA-Z]+ eol
blank_line = eol</pre>
</div>
</div>
<div class="paragraph">
<p>And the test input:</p>
</div>
<div class="listingblock">
<div class="content">
<pre># test

text</pre>
</div>
</div>
<div class="paragraph">
<p>The following trace output shows what Peggy chose as locations for its matches:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>{
  type: 'rule.match',
  rule: 'title',
  result: [ 't', 'e', 's', 't' ],
  location: {
    source: undefined,
    start: { offset: 2, line: 1, column: 3 },
    end: { offset: 6, line: 1, column: 7 }
  }
}
{
  type: 'rule.match',
  rule: 'eol',
  result: '\n',
  location: {
    source: undefined,
    start: { offset: 6, line: 1, column: 7 },
    end: { offset: 7, line: 2, column: 1 }
  }
}
{
  type: 'rule.match',
  rule: 'heading',
  result: [ [ '#' ], ' ', [ 't', 'e', 's', 't' ], '\n' ],
  location: {
    source: undefined,
    start: { offset: 0, line: 1, column: 1 },
    end: { offset: 7, line: 2, column: 1 }
  }
}
{
  type: 'rule.match',
  rule: 'eol',
  result: '\n',
  location: {
    source: undefined,
    start: { offset: 7, line: 2, column: 1 },
    end: { offset: 8, line: 3, column: 1 }
  }
}
{
  type: 'rule.match',
  rule: 'eol',
  result: '\n',
  location: {
    source: undefined,
    start: { offset: 12, line: 3, column: 5 },
    end: { offset: 13, line: 4, column: 1 }
  }
}
{
  type: 'rule.match',
  rule: 'text',
  result: [ [ 't', 'e', 'x', 't' ], '\n' ],
  location: {
    source: undefined,
    start: { offset: 8, line: 3, column: 1 },
    end: { offset: 13, line: 4, column: 1 }
  }
}
{
  type: 'rule.match',
  rule: 'document',
  result: [ [], [ [Array], ' ', [Array], '\n' ], [ '\n' ], [ [Array] ] ],
  location: {
    source: undefined,
    start: { offset: 0, line: 1, column: 1 },
    end: { offset: 13, line: 4, column: 1 }
  }
}</pre>
</div>
</div>
<div class="paragraph">
<p>In response to the questions posed by this document:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>File offsets or not:</strong> Yes, 0-based file offsets included</p>
</li>
<li>
<p><strong>Zero-based or one-based</strong>: 0-based file offsets, but 1-based line and column</p>
</li>
<li>
<p><strong>Inclusive or exclusive</strong>: inclusive start, exclusive end</p>
</li>
<li>
<p><strong>Special representation:</strong> appears not, newlines are just another character</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_antlr">Antlr</h4>
<div class="paragraph">
<p><a href="https://www.antlr.org/">ANTLR</a> is another common parser, and at least tracks locations on lexed tokens.</p>
</div>
<div class="paragraph">
<p>You can see the <code>antlr-test/</code> folder for a sample of its behavior.</p>
</div>
<div class="paragraph">
<p>With the lexer grammar:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>lexer grammar SampleLexer;

EOL : '\n' ;
HASH : '#' ;
SPACE : ' ';
WORD : [a-zA-Z]+ ;</pre>
</div>
</div>
<div class="paragraph">
<p>And the parser grammar:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>parser grammar SampleParser;
options { tokenVocab=SampleLexer; }

document : empty_line* heading_line? empty_line* text_line*;
empty_line : EOL ;
text : (WORD SPACE*)+ ;
text_line : text EOL ;
title : text ;
heading_line : HASH+ SPACE title EOL ;</pre>
</div>
</div>
<div class="paragraph">
<p>And the output:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>$ java -cp antlr-4.13.1-complete.jar org.antlr.v4.gui.Interpreter SampleLexer.g4 SampleParser.g4 document -trace -tokens ../peg-test/test.txt
[@0,0:0='#',&lt;'#'&gt;,1:0]
[@1,1:1=' ',&lt;' '&gt;,1:1]
[@2,2:5='test',&lt;WORD&gt;,1:2]
[@3,6:6='\n',&lt;'\n'&gt;,1:6]
[@4,7:7='\n',&lt;'\n'&gt;,2:0]
[@5,8:11='text',&lt;WORD&gt;,3:0]
[@6,12:12='\n',&lt;'\n'&gt;,3:4]
[@7,13:12='&lt;EOF&gt;',&lt;EOF&gt;,4:0]
enter   document, LT(1)=#
enter   heading_line, LT(1)=#
consume [@0,0:0='#',&lt;2&gt;,1:0] rule heading_line
consume [@1,1:1=' ',&lt;3&gt;,1:1] rule heading_line
enter   title, LT(1)=test
enter   text, LT(1)=test
consume [@2,2:5='test',&lt;4&gt;,1:2] rule text
exit    text, LT(1)=

exit    title, LT(1)=

consume [@3,6:6='\n',&lt;1&gt;,1:6] rule heading_line
exit    heading_line, LT(1)=

enter   empty_line, LT(1)=

consume [@4,7:7='\n',&lt;1&gt;,2:0] rule empty_line
exit    empty_line, LT(1)=text
enter   text_line, LT(1)=text
enter   text, LT(1)=text
consume [@5,8:11='text',&lt;4&gt;,3:0] rule text
exit    text, LT(1)=

consume [@6,12:12='\n',&lt;1&gt;,3:4] rule text_line
exit    text_line, LT(1)=&lt;EOF&gt;
exit    document, LT(1)=&lt;EOF&gt;</pre>
</div>
</div>
<div class="paragraph">
<p>The output is a little difficult to parse, but the token lines seem to be translated as so:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>[@2,2:5='test',&lt;WORD&gt;,1:2]</pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p><code>2:5</code> indicates the 0-based inclusive start and inclusive end file offset.</p>
</li>
<li>
<p><code>1:2</code> indicates the 1-based line offset and the 0-based column offset.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>In response to the questions posed by this document:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>File offsets or not:</strong> Yes, 0-based file offsets included</p>
</li>
<li>
<p><strong>Zero-based or one-based</strong>: 0-based file and column offsets, but 1-based line offset</p>
</li>
<li>
<p><strong>Inclusive or exclusive</strong>: inclusive start, inclusive end for tokens</p>
</li>
<li>
<p><strong>Special representation:</strong> appears not, newlines are just another character</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_languages">Languages</h3>
<div class="paragraph">
<p>This turned out to not be a super-informative:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Most programming languages provide 0-based indexing into strings and arrays</p>
</li>
<li>
<p>Most programming languages often provide substring operations with an inclusive start and exclusive end offset into the string</p>
</li>
</ul>
</div>
<div class="sect3">
<h4 id="_java">Java</h4>
<div class="paragraph">
<p>For operations within a string:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">"some text\n\nbelow a line\n".charAt(0); // 's'
"some text\n\nbelow a line\n".charAt(9); // '\n'
"some text\n\nbelow a line\n".charAt(14); // 'o'
"some text\n\nbelow a line\n".substring(5, 11); // 'text\n\n'</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_ruby">Ruby</h4>
<div class="paragraph">
<p>For operations within a string:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-ruby" data-lang="ruby">"some text\n\nbelow a line\n"[0] # "s"
"some text\n\nbelow a line\n"[9] # "\n"
"some text\n\nbelow a line\n"[14] # "o"
"some text\n\nbelow a line\n".[5..10] # 'text\n\n'
"some text\n\nbelow a line\n".slice(5, 6) # 'text\n\n'</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_common_lisp">Common Lisp</h4>
<div class="paragraph">
<p>For operations within a string:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-lisp" data-lang="lisp">CL-USER&gt; (defparameter text (concatenate 'string "some text" (string #\newline) (string #\newline) "below a line" (string #\newline)))
TEXT
CL-USER&gt; text
"some text

below a line
"
CL-USER&gt; (elt text 0)
#\s
CL-USER&gt; (elt text 9)
#\Newline
CL-USER&gt; (elt text 14)
#\o
CL-USER&gt; (subseq text 5 10)
"text
"</code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_editors">Editors</h3>
<div class="sect3">
<h4 id="_language_server_protocol">Language Server Protocol</h4>
<div class="paragraph">
<p><a href="https://microsoft.github.io/language-server-protocol/overviews/lsp/overview/">LSP</a> has become an extremely popular way to increase the reach of languages, by allowing a single LSP server implementation to integrate with any editor that acts as an LSP client. This avoids the MxN combination of integrations that previously needed to exist to support every language in every editor.</p>
</div>
<div class="sect4">
<h5 id="_positions">Positions</h5>
<div class="paragraph">
<p>LSP defines a <a href="https://microsoft.github.io/language-server-protocol/specifications/lsp/3.17/specification/#position">position</a> as a zero-based place <em>between</em> two characters in a text document. They use the term "character offset" as this document defined <strong>column offset</strong>. They further allow clarification of the "character offset" to count in units defined by UTF-8 (bytes), UTF-16, or UTF-32.</p>
</div>
<div class="paragraph">
<p>If a provided "character offset" is longer than the line, it is normalized to the line&#8217;s length.</p>
</div>
<div class="quoteblock">
<blockquote>
<div class="paragraph">
<p>Position in a text document expressed as zero-based line and zero-based character offset. A position is between two characters like an insert cursor in an editor. Special values like for example -1 to denote the end of a line are not supported.</p>
</div>
</blockquote>
</div>
<div class="paragraph">
<p>Additionally regarding the variety of end-of-line sequences that could be allowed:</p>
</div>
<div class="quoteblock">
<blockquote>
<div class="paragraph">
<p>To ensure that both client and server split the string into the same line representation the protocol specifies the following end-of-line sequences: \n, \r\n and \r. Positions are line end character agnostic. So you can not specify a position that denotes \r|\n or \n| where | represents the character offset.</p>
</div>
</blockquote>
</div>
</div>
<div class="sect4">
<h5 id="_ranges">Ranges</h5>
<div class="paragraph">
<p>LSP defines a <a href="https://microsoft.github.io/language-server-protocol/specifications/lsp/3.17/specification/#range">range</a> as zero-based start (inclusive) and end (exclusive) positions.</p>
</div>
<div class="quoteblock">
<blockquote>
<div class="paragraph">
<p>A range in a text document expressed as (zero-based) start and end positions. A range is comparable to a selection in an editor. Therefore, the end position is exclusive. If you want to specify a range that contains a line including the line ending character(s) then use an end position denoting the start of the next line.</p>
</div>
</blockquote>
</div>
</div>
<div class="sect4">
<h5 id="_usage">Usage</h5>
<div class="paragraph">
<p>Many LSP features build off the use of Position and Range, including:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="https://microsoft.github.io/language-server-protocol/specifications/lsp/3.17/specification/#textEdit">TextEdit</a> uses a Range and replacement text</p>
</li>
<li>
<p><a href="https://microsoft.github.io/language-server-protocol/specifications/lsp/3.17/specification/#location">Location</a> uses a document URI and a Range</p>
</li>
<li>
<p><a href="https://microsoft.github.io/language-server-protocol/specifications/lsp/3.17/specification/#locationLink">LocationLink</a> uses an origin Range a target document URI, Range, and selection Range.</p>
</li>
<li>
<p><a href="https://microsoft.github.io/language-server-protocol/specifications/lsp/3.17/specification/#diagnostic">Diagnostic</a> uses a Range and metadata about the identified problem</p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="_questions_2">Questions</h5>
<div class="paragraph">
<p>In relation to the questions posed in this document:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>File offsets or not:</strong> not used</p>
</li>
<li>
<p><strong>Zero-based or one-based:</strong> zero-based</p>
</li>
<li>
<p><strong>Inclusive or exclusive:</strong> inclusive start and exclusive end</p>
</li>
<li>
<p><strong>Special representation:</strong> none (explicitly calls out newlines as having no special values)</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_vs_code">VS Code</h4>
<div class="sect4">
<h5 id="_user_facing">User-Facing</h5>
<div class="paragraph">
<p>Visually in VS Code, the following locations are reported in the bottom bar. The <code>|</code> character is used to indicate the cursor position. I originally tried to grab screenshots, but had a hard time capturing the blinking cursor.</p>
</div>
<div class="paragraph">
<p>Cursors are located before a character allowing insertion of text.</p>
</div>
<div class="listingblock">
<div class="title">Line 1, Column 1</div>
<div class="content">
<pre>|some text

below a blank line</pre>
</div>
</div>
<div class="listingblock">
<div class="title">Line 1, Column 10</div>
<div class="content">
<pre>some text|

below a blank line</pre>
</div>
</div>
<div class="paragraph">
<p>Given the above cursor location, pressing the right arrow key on the keyboard gives the following position.</p>
</div>
<div class="listingblock">
<div class="title">Line 2, Column 1</div>
<div class="content">
<pre>some text
|
below a blank line</pre>
</div>
</div>
<div class="paragraph">
<p>Pressing right arrow one more time.</p>
</div>
<div class="listingblock">
<div class="title">Line 3, Column 1</div>
<div class="content">
<pre>some text

|below a blank line</pre>
</div>
</div>
<div class="paragraph">
<p>Within a line.</p>
</div>
<div class="listingblock">
<div class="title">Line 3, Column 4</div>
<div class="content">
<pre>some text

bel|ow a blank line</pre>
</div>
</div>
<div class="listingblock">
<div class="title">Line 3, Column 19</div>
<div class="content">
<pre>some text

below a blank line|</pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_api">API</h5>
<div class="paragraph">
<p>Internally, VS Codes APIs are instead zero-based, but otherwise equivalent to the visual positions. Given VS Code&#8217;s heavy association with LSP the overlap of definitions could fairly be considered just one example of behavior in the wild.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="https://code.visualstudio.com/api/references/vscode-api#Position">Position</a> is a zero-based line offset and zero-based character (column) offset as with LSP.</p>
</li>
<li>
<p><a href="https://code.visualstudio.com/api/references/vscode-api#Selection">Selection</a> is a range from an anchor position to the active position (active being the position of the cursor).</p>
</li>
<li>
<p><a href="https://code.visualstudio.com/api/references/vscode-api#Range">Range</a> is a start and end position.</p>
</li>
<li>
<p><a href="https://code.visualstudio.com/api/references/vscode-api#Diagnostic">Diagnostic</a> includes a range and metadata about the problem.</p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="_questions_3">Questions</h5>
<div class="paragraph">
<p>In response to the questions posed in this document, see the answers for LSP as nothing seems different here. The only minor exception is that while it&#8217;s internal API is zero-based like LSP, the visual display of line offset and column offset is one-based.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_emacs">Emacs</h4>
<div class="sect4">
<h5 id="_positions_2">Positions</h5>
<div class="ulist">
<ul>
<li>
<p><a href="https://www.gnu.org/software/emacs/manual/html_node/elisp/Positions.html">Positions</a></p>
<div class="quoteblock">
<blockquote>
<div class="paragraph">
<p>A position is the index of a character in the text of a buffer. More precisely, a position identifies the place between two characters (or before the first character, or after the last character), so we can speak of the character before or after a given position. However, we often speak of the character at a position, meaning the character after that position.</p>
</div>
<div class="paragraph">
<p>Positions are usually represented as integers starting from 1</p>
</div>
</blockquote>
</div>
</li>
<li>
<p><a href="https://www.gnu.org/software/emacs/manual/html_node/elisp/Point.html">Point</a> (the cursor)</p>
<div class="quoteblock">
<blockquote>
<div class="paragraph">
<p>Point is a special buffer position used by many editing commands, including the self-inserting typed characters and text insertion functions. Other commands move point through the text to allow editing and insertion at different places.</p>
</div>
<div class="paragraph">
<p>Like other positions, point designates a place between two characters (or before the first character, or after the last character), rather than a particular character. Usually terminals display the cursor over the character that immediately follows point; point is actually before the character on which the cursor sits.</p>
</div>
<div class="paragraph">
<p>The value of point is a number no less than 1, and no greater than the buffer size plus 1. If narrowing is in effect (see Narrowing), then point is constrained to fall within the accessible portion of the buffer (possibly at one end of it).</p>
</div>
</blockquote>
</div>
</li>
<li>
<p><a href="https://www.gnu.org/software/emacs/manual/html_node/elisp/Columns.html">Columns</a></p>
<div class="quoteblock">
<blockquote>
<div class="paragraph">
<p>These functions count each character according to the number of columns it occupies on the screen. This means control characters count as occupying 2 or 4 columns, depending upon the value of ctl-arrow, and tabs count as occupying a number of columns that depends on the value of tab-width and on the column where the tab begins.</p>
</div>
</blockquote>
</div>
<div class="quoteblock">
<blockquote>
<div class="paragraph">
<p>Function: current-column </p>
</div>
<div class="literalblock">
<div class="content">
<pre>This function returns the horizontal position of point, measured in columns, counting from 0 at the left margin. The column position is the sum of the widths of all the displayed representations of the characters between the start of the current line and point.</pre>
</div>
</div>
</blockquote>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">Commentary</div>
<div class="paragraph">
<p>Emacs notably uses visual columns rather than a count of characters in the line. These are also zero-based, while the line offsets and file offsets are one-based.</p>
</div>
</div>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>With a similar example to the VS Code one, I use a combination of <code>M-:</code> and <code>(point)</code> to identify the current location of point in a buffer and <code>(line-number-mode 1)</code> <code>(column-number-mode 1)</code> to display the line/column in the modeline. As with the VS Code examples <code>|</code> will indicate the location of point (the cursor).</p>
</div>
<div class="listingblock">
<div class="title">Position 1, Line 1, Column 0</div>
<div class="content">
<pre>|some text

below a blank line</pre>
</div>
</div>
<div class="listingblock">
<div class="title">Position 10, Line 1, Column 9</div>
<div class="content">
<pre>some text|

below a blank line</pre>
</div>
</div>
<div class="paragraph">
<p>Given the above cursor location, pressing <code>C-f</code> (the <code>forward-char</code> command) on the keyboard gives the following position.</p>
</div>
<div class="listingblock">
<div class="title">Position 11, Line 2, Column 0</div>
<div class="content">
<pre>some text
|
below a blank line</pre>
</div>
</div>
<div class="paragraph">
<p>Pressing <code>C-f</code> (the <code>forward-char</code> command) one more time.</p>
</div>
<div class="listingblock">
<div class="title">Position 12, Line 3, Column 0</div>
<div class="content">
<pre>some text

|below a blank line</pre>
</div>
</div>
<div class="paragraph">
<p>Within a line.</p>
</div>
<div class="listingblock">
<div class="title">Position 15, Line 3, Column 3</div>
<div class="content">
<pre>some text

bel|ow a blank line</pre>
</div>
</div>
<div class="paragraph">
<p>If you call <code>(pos-eol)</code> with the above point location, you get position 30 as you would be moving the point to the end of the line like below.</p>
</div>
<div class="listingblock">
<div class="title">Position 30, Line 3, Column 18</div>
<div class="content">
<pre>some text

below a blank line|</pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_ranges_2">Ranges</h5>
<div class="ulist">
<ul>
<li>
<p><a href="https://www.gnu.org/software/emacs/manual/html_node/elisp/The-Mark.html">Mark</a></p>
<div class="quoteblock">
<blockquote>
<div class="paragraph">
<p>The mark specifies a position to bound a range of text for many commands, such as kill-region and indent-rigidly. These commands typically act on the text between point and the mark, which is called the region.</p>
</div>
</blockquote>
</div>
</li>
<li>
<p><a href="https://www.gnu.org/software/emacs/manual/html_node/elisp/The-Region.html">Region</a></p>
<div class="quoteblock">
<blockquote>
<div class="paragraph">
<p>The text between point and the mark is known as the region.</p>
</div>
</blockquote>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>The Region is equivalent to the primary Selection in VS Code. <code>(region-beginning)</code> and <code>(region-end)</code> can be used to identify the positions bounding the region. In the example below, I use two <code>|</code> to denote the mark and the point.</p>
</div>
<div class="listingblock">
<div class="title">Start Position 6, End Position 11</div>
<div class="content">
<pre>some |text
|
below a blank line</pre>
</div>
</div>
<div class="paragraph">
<p>If I use <code>kill-region</code> to illustrate what&#8217;s included in the region, you can see that the region start is inclusive and the region end is exclusive.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>some |
below a blank line</pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_navigation">Navigation</h5>
<div class="paragraph">
<p>Emacs provides functions like <code>(goto-char position)</code> that take a one-based integer position as described above. Along with ones to move a relative number of characters, words, lines, etc.</p>
</div>
</div>
<div class="sect4">
<h5 id="_questions_4">Questions</h5>
<div class="paragraph">
<p>In response to the questions posed by this document:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>File offsets or not:</strong> Yes, file offsets are in fact the primary way of finding a position in a document. Navigating to a location by line and column is possible, but requires knowledge of the special handling of columns.</p>
</li>
<li>
<p><strong>Zero-based or one-based:</strong> Mostly one-based, but columns are zero-based.</p>
</li>
<li>
<p><strong>Inclusive or exclusive:</strong> Regions have an inclusive start and exclusive end</p>
</li>
<li>
<p><strong>Special representation:</strong> Newlines don&#8217;t seem to have any special representation, however tab characters do as defined by <code>tab-width</code> which controls the visual number of columns that a tab character takes up.</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_intellij">Intellij</h4>
<div class="sect4">
<h5 id="_user_facing_2">User-Facing</h5>
<div class="paragraph">
<p>Visually in Intellij, the following locations are reported in the bottom bar. The <code>|</code> character is used to indicate the cursor position. Cursors are located before a character allowing insertion of text.</p>
</div>
<div class="listingblock">
<div class="title">Line 1, Column 1</div>
<div class="content">
<pre>|some text

below a blank line</pre>
</div>
</div>
<div class="listingblock">
<div class="title">Line 1, Column 10</div>
<div class="content">
<pre>some text|

below a blank line</pre>
</div>
</div>
<div class="paragraph">
<p>Given the above cursor location, pressing the right arrow key on the keyboard gives the following position.</p>
</div>
<div class="listingblock">
<div class="title">Line 2, Column 1</div>
<div class="content">
<pre>some text
|
below a blank line</pre>
</div>
</div>
<div class="paragraph">
<p>Pressing right arrow one more time.</p>
</div>
<div class="listingblock">
<div class="title">Line 3, Column 1</div>
<div class="content">
<pre>some text

|below a blank line</pre>
</div>
</div>
<div class="paragraph">
<p>Within a line.</p>
</div>
<div class="listingblock">
<div class="title">Line 3, Column 4</div>
<div class="content">
<pre>some text

bel|ow a blank line</pre>
</div>
</div>
<div class="listingblock">
<div class="title">Line 3, Column 19</div>
<div class="content">
<pre>some text

below a blank line|</pre>
</div>
</div>
<div class="paragraph">
<p>Selections are visually reported as the cursor location and a count of characters included. In the example below, I use two <code>|</code> to denote the mark and the point.</p>
</div>
<div class="listingblock">
<div class="title">Line 2, Column 1, 5 characters, 1 line break</div>
<div class="content">
<pre>some |text
|
below a blank line</pre>
</div>
</div>
<div class="paragraph">
<p>If I use <code>Cut</code> to illustrate what&#8217;s included in the region, you can see that the selection start is inclusive and the region end is exclusive.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>some |
below a blank line</pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_api_2">API</h5>
<div class="paragraph">
<p>The Jetbrains API was less clear on definitions compared to VS Code and Emacs, so I&#8217;ll leave that as an exercise to the reader, but I&#8217;d expect some level of consistency with the user-facing results here.</p>
</div>
<div class="paragraph">
<p>The best hint I found was in <a href="https://github.com/JetBrains/intellij-community/blob/idea/233.14475.28/platform/core-api/src/com/intellij/lexer/Lexer.java#L82-L90">the Lexer API</a> which used a single offset, which implied use of file offsets internally.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_questions_5">Questions</h4>
<div class="paragraph">
<p>In response to the questions posed by this doc:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>File offsets or not:</strong> Some hints that they are used internally</p>
</li>
<li>
<p><strong>Zero-based or one-based:</strong> Visually, Intellij reports one-based line/column offsets</p>
</li>
<li>
<p><strong>Inclusive or exclusive:</strong> inclusive start and exclusive end</p>
</li>
<li>
<p><strong>Special representation:</strong> appears not</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_vim">Vim</h4>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
My Vim knowledge is very minimal, so there may be inaccuracies here.
</td>
</tr>
</table>
</div>
<div class="sect4">
<h5 id="_user_facing_3">User-Facing</h5>
<div class="paragraph">
<p>Vim&#8217;s behavior differs between normal mode and insert mode. The following line and column positions are reported at the bottom.</p>
</div>
<div class="paragraph">
<p>The unique display when on the newline character of a blank line appears to be described as a "split column" display in <a href="https://vimhelp.org/usr_03.txt.html#usr_03.txt">the documentation</a>:</p>
</div>
<div class="quoteblock">
<blockquote>
<div class="paragraph">
<p>Sometimes you will see a split column number.  For example, "col 2-9".
This indicates that the cursor is positioned on the second character, but
because character one is a tab, occupying eight spaces worth of columns,
the screen column is 9.</p>
</div>
</blockquote>
</div>
<div class="listingblock">
<div class="title">Normal mode and insert mode, Line 1, Column 1</div>
<div class="content">
<pre>|some text

below a blank line</pre>
</div>
</div>
<div class="listingblock">
<div class="title">Normal mode, cannot navigate here; Insert mode, Line 1, Column 10</div>
<div class="content">
<pre>some text|

below a blank line</pre>
</div>
</div>
<div class="listingblock">
<div class="title">Normal mode, Line 2, Column 0-1; Insert mode, Line 2, Column 1</div>
<div class="content">
<pre>some text
|
below a blank line</pre>
</div>
</div>
<div class="listingblock">
<div class="title">Normal mode and insert mode, Line 3, Column 1</div>
<div class="content">
<pre>some text

|below a blank line</pre>
</div>
</div>
<div class="listingblock">
<div class="title">Normal mode and insert mode, Line 3, Column 4</div>
<div class="content">
<pre>some text

bel|ow a blank line</pre>
</div>
</div>
<div class="listingblock">
<div class="title">Normal mode, cannot navigate here; Insert mode, Line 3, Column 19</div>
<div class="content">
<pre>some text

below a blank line|</pre>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_api_3">API</h4>
<div class="ulist">
<ul>
<li>
<p><a href="https://vimhelp.org/builtin.txt.html#col%28%29">col()</a> gets the byte index of the given position. The end of the line is count of bytes on the line plus 1. The first character of the column is 1. There are separate functions for visual/screen columns.</p>
</li>
<li>
<p><a href="https://vimhelp.org/builtin.txt.html#line%28%29">line()</a> gets the line number of the given position which appears to be 1-based.</p>
</li>
<li>
<p><a href="https://vimhelp.org/builtin.txt.html#cursor%28%29">cursor()</a> positions the cursor at a line and column (byte offset)</p>
</li>
<li>
<p><a href="https://vimhelp.org/builtin.txt.html#getpos%28%29">getpos()</a> gets a position returning a list of <code>bufnum</code> (seems like an indicator of the mark), <code>lnum</code> (line number), <code>cnum</code> (column = byte offset), <code>off</code> (indicating if virtual mode is used or not).</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_questions_6">Questions</h4>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
I&#8217;m not very confident of the answers here, being very unfamiliar with Vimscript, so I couldn&#8217;t easily test out the API.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>In response to the questions posed in this document:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>File offsets or not:</strong> doesn&#8217;t seem like it</p>
</li>
<li>
<p><strong>Zero-based or one-based:</strong> one-based</p>
</li>
<li>
<p><strong>Inclusive or exclusive:</strong> I couldn&#8217;t tell</p>
</li>
<li>
<p><strong>Special representation:</strong> Newlines/tabs, etc. seem to get visually indicated in split mode, but internally the byte offset in the line is what gets used. Ultimately, I&#8217;d probably say no special representation.</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_summary">Summary</h3>
<div class="paragraph">
<p>This is clearly only a subset of possible software I could have surveyed, and its possible I missed finer points in some of them (especially Vim), but it can illustrate a few things:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Common editors <em>do</em> allow you to navigate to an empty line by indicating the first column (0 or 1, depending on the 0-based or 1-based scheme used).</p>
</li>
<li>
<p>While some editors APIs/commands will accept a negative or beyond the line end value for the column, they just wrap you back to the first or last column. Even Vim&#8217;s split-mode display of newline and tab characters seemed merely visual and not something that carried over to the API for positioning.</p>
</li>
<li>
<p>Zero and one based decision is kind of all over the place, but there seemed to be a trend of 1-based in human-oriented output and 0-based in many (but not all) internal APIs.</p>
<div class="ulist">
<ul>
<li>
<p>Emacs and Vim were both 1-based internally for line and/or file offsets, but 0-based for columns.</p>
</li>
</ul>
</div>
</li>
<li>
<p>Inclusive start and exclusive end seemed common (ANTLR being the notable exception for its token locations).</p>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_my_proposal">My Proposal</h2>
<div class="sectionbody">
<div class="paragraph">
<p>In response to the questions posed by this document, my proposal for AsciiDoc&#8217;s <code>location</code> property calculation is:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Purpose/Goals:</strong> Focus on how to report warnings/errors to the end user and on how to integrate with other software. Do not expect and end user to directly read the ASG and optimize for that. Machine-friendliness in the spec is human-friendliness to the implementor and to the user who interacts with the integrated documentation system.</p>
</li>
<li>
<p><strong>File offsets or not:</strong> I initially expected this to be a little more clearly in favor of these file offsets being a key machine interface, but it seems many editors do expose line/col based APIs. I do think this is a useful addition, though, as other software needs to separately index line positions to know how to navigate to a specific line/column. Some software does that for you and exposes the API with that assumption, but some software won&#8217;t and a file offset is pretty easy in most languages to deal with by just indexing into an array/string.</p>
</li>
<li>
<p><strong>Zero-based or one-based:</strong> Peggy&#8217;s approach seemed like a reasonable compromise. Zero-based file offsets, which a machine can easily use, and 1-based location and column info. Lots of software uses 1-based lines, columns is more of a mixed bag though.</p>
<div class="paragraph">
<p>Admittedly, this is what I chose internally in my implementation before looking at Peggy, so I do have a bias.</p>
</div>
</li>
<li>
<p><strong>Inclusive or exclusive:</strong> Inclusive start and exclusive end seemed like the predominant favorite. It also aligns well with common substring operations, on top of most editor APIs.</p>
</li>
<li>
<p><strong>Special representation:</strong> No, there should not be any special representation for newlines. It does not appear to be canonical in any of the software surveyed in this document. This would require both exceptional handling in the parser implementations as well as exceptional handling in translating to other software you would integrate with.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>As modifications to what is currently defined:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Removal of the special 0 column indicator for empty lines.</p>
</li>
<li>
<p>Possible addition of 0-based offsets to the <code>location</code> property.</p>
</li>
</ul>
</div>
</div>
</div>
</div>
<div id="footer">
<div id="footer-text">
Last updated 2024-03-02 19:22:04 -0600
</div>
</div>
</body>
</html>